import pandas as pd
import numpy as np
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split
from sklearn import tree

import pickle
from joblib import Parallel, delayed
import joblib


dataset1 = pd.read_csv("Kaggle-data.csv")
columns = ["AddressOfEntryPoint",	"MajorLinkerVersion","MajorImageVersion","MajorOperatingSystemVersion",	"DllCharacteristics",	"SizeOfStackReserve",	"SectionsNb","ResourcesNb","legitimate"]
malware_dataset = dataset1[columns]
#Extract artifacts samples fileds "AddressOfEntryPoint" and "DLLCharacteristics"
samples = malware_dataset.iloc[:, [0, 4]].values
targets = malware_dataset.iloc[:, 8].values
#Splitting into training and testing dataset
X_train, X_test, y_train, y_test = train_test_split(samples, targets, test_size = 0.3, random_state = 0)
model = tree.DecisionTreeClassifier()
model.fit(X_train, y_train)
predictions = model.predict(X_test)
accuracy = 100* accuracy_score(y_test, predictions)
print("Decision Tree accuracy: " + str(accuracy))

# Saving model
pickle.dump(model,open('models/model.pkl','wb'))

# Loading model from pickle to check
model = pickle.load(open('models/model.pkl','rb'))
print(model.predict(X_test))